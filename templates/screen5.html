<div class="screen active" id="screen5">
    <div class="wechat-header">
        设置行程
    </div>
    
    <div style="flex: 1; display: flex; flex-direction: column; padding: 15px;">
        <!-- Route setup -->
        <div style="background-color: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; color: #666; margin-bottom: 8px; display: flex; align-items: center;">
                    <span style="margin-right: 8px;">📍</span>出发地
                </div>
                <div style="background-color: #f8f8f8; padding: 15px; border-radius: 8px; border: 1px solid #e0e0e0;">
                    <div style="font-size: 16px; color: #333;">北京市朝阳区建国门外大街</div>
                    <div style="font-size: 12px; color: #999; margin-top: 4px;">当前位置</div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: center; margin: 15px 0;">
                <div style="width: 2px; height: 30px; background-color: #ddd;"></div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="font-size: 14px; color: #666; margin-bottom: 8px; display: flex; align-items: center;">
                    <span style="margin-right: 8px;">🎯</span>目的地
                </div>
                <div style="background-color: #f8f8f8; padding: 15px; border-radius: 8px; border: 1px solid #e0e0e0; display: flex; align-items: center;">
                    <input id="destination-input" type="text" placeholder="请输入目的地" style="border: none; background: none; outline: none; flex: 1; font-size: 16px;">
                    <button id="voice-btn" class="btn btn-secondary" style="padding: 8px 16px; font-size: 14px; margin-left: 10px;">
                        🎤 语音输入
                    </button>
                </div>
            </div>
            
            <button id="confirm-location-btn" class="btn btn-primary" style="width: 100%; height: 45px; font-size: 16px;" disabled>
                确认行程
            </button>
        </div>
        
        <!-- Voice input animation area -->
        <div id="voice-animation" style="display: none; background-color: #f0f8ff; border-radius: 12px; padding: 30px; margin-bottom: 20px; text-align: center;">
            <div style="width: 80px; height: 80px; background-color: #2196f3; border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 32px; animation: pulse 1.5s ease-in-out infinite;">
                🎤
            </div>
            <div style="font-size: 16px; color: #1976d2; margin-bottom: 10px;">正在听取语音...</div>
            <div style="font-size: 14px; color: #666;">请说出您的目的地</div>
        </div>
        
        <!-- Real map -->
        <div id="map-container" style="background-color: #f5f5f5; border-radius: 12px; height: 200px; margin-bottom: 20px; position: relative; overflow: hidden; cursor: grab;">
            <img id="route-map" src="{{ url_for('static', filename='images/route.png') }}" alt="路线图" style="width: 100%; height: 100%; object-fit: cover; user-select: none; -webkit-user-drag: none;">
        </div>
        
        <!-- Trip info -->
        <div style="background-color: white; border-radius: 12px; padding: 15px; border: 1px solid #e0e0e0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div style="font-size: 14px; color: #666;">预估距离</div>
                <div class="trip-distance" style="font-size: 16px; color: #333; font-weight: 500;">约 15 公里</div>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="font-size: 14px; color: #666;">预估时间</div>
                <div class="trip-duration" style="font-size: 16px; color: #333; font-weight: 500;">约 30 分钟</div>
            </div>
        </div>
        
        <!-- Instruction bubble -->
        <div style="background-color: #e3f2fd; padding: 15px; border-radius: 12px; border-left: 4px solid #2196f3; margin-top: 20px;">
            <div style="display: flex; align-items: flex-start;">
                <div style="width: 30px; height: 30px; background-color: #2196f3; border-radius: 50%; margin-right: 10px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: bold;">蓝</div>
                <div>
                    <strong style="color: #1976d2; font-size: 14px;">小蓝提示：</strong>
                    <p style="margin-top: 5px; font-size: 13px; color: #1976d2; line-height: 1.4;">
                        点击"语音输入"按钮，然后清晰地说出"鸟巢"
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        #map-container.dragging {
            cursor: grabbing;
        }
        
        #route-map {
            transition: transform 0.1s ease-out;
        }
    </style>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mapContainer = document.getElementById('map-container');
            const routeMap = document.getElementById('route-map');
            let isDragging = false;
            let startX;
            let startY;
            let currentX = 0;
            let currentY = 0;
            let initialX;
            let initialY;
            
            // Mouse events
            mapContainer.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);
            
            // Touch events for mobile
            mapContainer.addEventListener('touchstart', dragStart);
            document.addEventListener('touchmove', drag);
            document.addEventListener('touchend', dragEnd);
            
            function dragStart(e) {
                if (e.type === 'touchstart') {
                    startX = e.touches[0].clientX - currentX;
                    startY = e.touches[0].clientY - currentY;
                } else {
                    startX = e.clientX - currentX;
                    startY = e.clientY - currentY;
                }
                
                initialX = currentX;
                initialY = currentY;
                
                if (e.target === routeMap || e.target === mapContainer) {
                    isDragging = true;
                    mapContainer.classList.add('dragging');
                }
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                e.preventDefault();
                
                if (e.type === 'touchmove') {
                    currentX = e.touches[0].clientX - startX;
                    currentY = e.touches[0].clientY - startY;
                } else {
                    currentX = e.clientX - startX;
                    currentY = e.clientY - startY;
                }
                
                routeMap.style.transform = `translate(${currentX}px, ${currentY}px)`;
            }
            
            function dragEnd(e) {
                if (!isDragging) return;
                
                isDragging = false;
                mapContainer.classList.remove('dragging');
                
                // Optional: Reset position if dragged too far
                const maxDrag = 100;
                if (Math.abs(currentX) > maxDrag || Math.abs(currentY) > maxDrag) {
                    currentX = 0;
                    currentY = 0;
                    routeMap.style.transform = 'translate(0px, 0px)';
                }
            }
            
            // Double click to reset position
            mapContainer.addEventListener('dblclick', function() {
                currentX = 0;
                currentY = 0;
                routeMap.style.transform = 'translate(0px, 0px)';
            });
        });
    </script>
</div>
